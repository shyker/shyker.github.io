# backend/main.py
from fastapi import FastAPI, Body
from fastapi.middleware.cors import CORSMiddleware
import random

app = FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

DIALOGUE_DATA = {
    "default": ["designing", "......"],
    "click": ["designing"],
    
    # 首页逻辑
    "home_entry": ["欢迎来到我的博客"],
    "home_click": ["这里有些许小巧思，也有些许文章","有些地方还在完善之中，请见谅","点点那个唱片试试看"],

    # 关于页 (About/WhoAmI) 逻辑 🔥
    # 统一支持 "about" 和 "whoami" 两个 ID 
    "about_entry": ["关于我"],
    "blog_whoami_click": [ 
              "5hy1er无不良嗜好，但他就是想让我抽烟",
              "具体一点的话，我会出没于东湖长椅上，晚饭或什么的",
              "苹果普普通通，我也普普通通，放很久都不会坏，但我经常在校门口买到坏苹果",
              "今天吃早餐了吗？","今天没有早餐",
              "如果你天天吃早餐，我会默认你的生活已经步入正轨，非常的正",
              "其实我对文学一窍不通，这些都是装的，那就看我装吧",
              "这些文字大都写于一个小酒馆，一个冬天，与一只不嫌弃我的小猫，一位不嫌弃我的老板，我对此十分感激",
              "零零碎碎拼拼凑凑平平常常顺顺淡淡" ,
              "我很喜欢时至今日这个词，给人一种故事仍在继续的感觉",
              "我的语文很差，一直是，",
              "“我的脸很臭，但我经常唐笑弥补了这一点”",
              "“世界是一个巨大的棺材，我每天躺下练习葬礼，直到一天不再掀起被子”",
              "无助的隔壁 香芋追苹果 大口大口的喝",
              "其实我还想写点我喜欢的歌手，但是想来想去拿不定主意，索性就不写了",
              "东湖是一个好地方，没有什么人会侵犯我的长椅，但我会",
              "想到什么说什么，不太好",
              "shyler这个名字是怎么来的呢",
              "“眼里一片海，我却不肯蓝”",
              "about这页写了好多话，bb赖赖的",
              "你认识白色翻译家吗",
              "你认识黑色翻译家和褐色翻译家吗",
              "我在高中时期最喜欢的作家是鲁迅",
              "我对星座不敢兴趣，无论怎样看起来都像是对号入座，这种观测会在无形中干预种种",
              "我的MBTI是xswl",
              "我是后背",
                    ],
    "blog_whoami_entry": ["whoami"],
    "about_click": [
        # '我觉得蛮酷，就写了下来',
            #    '现在想想，我有的想',
               '心与天共老',
               '笨嘴又拙舌不要责怪我',
               '太多的感受融进这万家灯火',
               "我替你送晚秋去延安",
                "我替你陪老板吃便饭",
                "等我回天津摆佛龛",
                "我和你一起爱左蓝",
                "我也想从重庆走延安",
                "我也想抱着雨农撞岱山",
                "我也想重回海河天津站",
                "我也想梦中念左蓝",
                "你们编织在华北的浪漫",
                "全刻在小卧室的天花板",
                "你那峨眉峰埋葬在对岸",
                "渤海深处写满了不甘",
               '吹吹海风，听听晚钟',
               '一退再退，无处去追',
               '爱与冲动 谁吹来的风',
               '怨与感动 谁承受着痛',
               '恨与惶恐 谁做谁的梦',
               '明天我们吃什么',
               '悲哀藏在现实中',
               '幻想着自由的生活如夏花般绚烂的诱惑',
               '情绪用音符来包裹是被动又无奈的选择',
               '你眼中期待着什么',
               '华北无浪漫 死海扬起帆',
               '峨眉脚下',
               '星辰暗淡 风声疲倦',
               '春夏冰凉 秋冬暖阳',
               '我允许流淌',
               '递给世界沉默的情话',
               '是你不该有的卑微期待',
               '安稳的日子总是最重要',
               '我也摸不到那上游的风',
               '眼前长河 身后烈火',
               '有些想说喝多了才敢说',
               '我也曾低头一意孤行心中事难平',
               '蓝色的天空揭开过往',
               '谁陪我一起叫嚷',
               '暮色将至我还在等',
               '独立沉湖烂个体',
               '冥顽不化心不移',
               '昨夜幻想无端生海浪丢进水中央',
            #    '快给我灌下那碗鸡汤去迎接新的开场',
               '我也知道应该放下怨念勇敢向前看',
               '没有值得称赞的苦难何必纠缠漫长的昨天',
               '从过去跑向峨眉脚下孕育新生的傍晚',
               '它带我穿过盆地阴雨天让蜀道不再难',
               '他只恨自己是无法成为山峰的平原',
            #    '无常是灭不掉的灯 生命是拜不完的神',
                # '把悲欢离合养成大树 脆弱熬制成苦',
                # '遗憾是填不满的坑 思念是关不紧的门',
                '我是住在大海里的聋子一生的假想敌就是电线杆上的高音喇叭',
                '疾风知劲草，板荡识诚臣 。勇夫安识义，智者必怀仁。',
        ],

    "bento_shyler": ["ı̣ɯɐoɥM"],
    "bento_redis": ["些许古老"],
    "bento_redis2": ["些许古老"],
    "bento_communist": ["全世界无产者，联合起来！"],
    "mouth": ["这里本来是打算放点博客的，收集中", "你好。"],
    
    "6ydeco1_click":["厌学小姐不喜欢葱，香菜，火龙果等",
                "也不喜欢很辣的东西",
                "壁虎，是壁虎，吓她一跳",
                "记录厌学小姐的不喜欢中....."
                ],
    "6ydeco2_click":["'我就知道你在骂我'","......","嘻嘻，犯贱我猜厌学小姐就是这个表情"],
    "6ydeco3_click":["我也好想你","不过很快就能见面了"],
    "6ydeco4_click":["厌学小姐速通科目二，好厉害","你坐不坐我后面","带带我呗"],
    "6ydeco5_click":["不知道，你猜猜我放这只HelloKitty是什么意思"],
    "6ydeco6_click":["你就这样撩我吧","好甜蜜","一起洗澡啊","发只奶龙"],
    "6ydeco7_click":["一只奶龙版的厌学小姐","有点可爱","龙y","奖励一颗糖"],
    "6ydeco8_click":["认真学习的厌学小姐","xm100y","100y"],
    "6ydeco9_click":["喜欢薛之谦的一只小猫","和我一起听好呗"],
    "6ydeco10_click":["不知道此时的厌学小姐看到是什么心情"],
    "6ydeco11_click":["厌学小姐今年19，我在生日时给了她一个惊喜，她说，她很感动"],
    "6ydeco12_click":["你要吃了我吗","我以后做好吃的喂你","西蓝花小姐"],
    "6ydeco13_click":["骗你的，其实是我吃厌学小姐","厌学小姐爆汁儿了"],
    "whosheis_entry":["天天开心，厌学小姐"],
    "whosheis_click":["这里还有一点小恶心话说",
                      "我想你了,你想我不,看到扣1，没看到扣眼珠子",
                      "我想我们要走的路还会很长很长，我想不会离开你",
                      "想和你见面，我们什么都谈，不要责怪我的孤陋寡闻",
                      "想和你散步，我们什么话都不说，就这么走着",
                      "那几只小猫都有两三句小话，不知道你发现了没有",
                      "Aununo说的鬼话你别信，要是还有别的小女孩我给整这出能给我累死",
                      "唉我写到这里突然有个好主意，有些想说不敢说的悄悄话我说不定可以放在这里，等你来看",
                      "现在还只是一个demo，还得好好优化一下，不然一直刷会很累,博客那些还没有这么完善仔细的设计，随便看看吧",
                      "我不会忘记那些夜晚，我到死都会记得，我会把奶咯抱在胸口，感觉很踏实",
                      "感谢你同我分享那些日常，无论好坏",
                      "我还有好多好多想说的话，还有好多想做的事，等我一会呗",
                      "算上这条，总共有14条，不写多了，你要是运气背点说不定刷到这条几次了都没刷完",
                      "我无法衡量我现在的幸福，这是一种不同的归属"
                      ],
    "friends_entry":["友链"],
    "friends_click":["我的朋友们","友链环节","阿杰咯~"],
    "3906_click":['大帅！室长！',"我已经默认3906保研了","一位脱离了低级趣味的科幻迷","怀念厕所时日"],
    "zenus10_click":["教会了我许多","其本人参与该海报拍摄","给个design-flag","未曾谋面"],
    "cty_click":["cty会发点美好的东西","cty教我后端"],
    "lqh_click":["MiLoong祖师爷","龙中龙","非常有默契，在某些地方志同道合","Tuffy紫老鼠是谁？并非吧"],
    "muru_click":["神秘羊头人之一"],
    "nb_click":["东北神秘pwn大嗨客","能和我打一辈子CTF吗","N1n3Bird，又名鸠","NB教我PWN","神秘羊头人之一"],
    "xiaozhiqiao_click":["壳师傅","那个海豚头像是谁，哦也是你","挖洞大手小枳壳"],
    "hanggoushi_click":["行狗屎","杲是光明的意思","被我睡了三年","成都第一深情"],
    "oakbutton_click":["非常创造的一只电专鼠","confident guy","awesome always"],
    "zzx_click":["GGbond你的菲菲呢","你们ml的怎么都那么卷啊","人脉这一块"],
    "fuxi_click":["神","这才是真正的Learning in Uestc"],
    "Aununo_click":["how are you today","亦师亦友","when you flow,life follows","let it be","AAAununo"],
    "shenshen_click":["你老公是gay是不是","大学燊","木上焱"],
    "jerry_click":["三国杀祁连山的信号是你放的吧","文明六六六","教我mmx"],
    "whynot_click":['uestc的一座大山',"你们ml的怎么都那么卷啊","xm珠峰"],
    "klare_click":["神秘大嗨客之一","教我web","给个flag"],
    "aut_click":["我也想接入恋时代","AuT,睡觉方向负责人"],
    "yyyyyy_click":["明天想见的人","shylef","How to Unlock?","𝚠𝚑𝚘𝚜𝚑𝚎𝚒𝚜?"]


}

@app.post("/api/get-dialogue")
async def get_dialogue(data: dict = Body(...)):
    trigger_type = data.get("trigger_type", "default")
    page_id = data.get("page_id", "home")
    
    # 构造复合键：如 "about_entry"
    combined_key = f"{page_id}_{trigger_type}"
    
    # 优先级查找：
    # 1. 页面_动作 (如 about_click)
    if combined_key in DIALOGUE_DATA:
        choices = DIALOGUE_DATA[combined_key]
    # 2. 页面通用 (如 about)
    elif page_id in DIALOGUE_DATA:
        choices = DIALOGUE_DATA[page_id]
    # 3. 动作通用 (如 click)
    elif trigger_type in DIALOGUE_DATA:
        choices = DIALOGUE_DATA[trigger_type]
    else:
        choices = DIALOGUE_DATA["default"]
        
    return {"message": random.choice(choices)}

if __name__ == "__main__":
    import uvicorn
    # 确保端口与前端一致
    uvicorn.run(app, host="0.0.0.0", port=8000)